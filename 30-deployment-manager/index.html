
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tanviralam.com/30-deployment-manager/">
      
      
        <link rel="prev" href="../29-internal-load-balancer/">
      
      
        <link rel="next" href="../31-aws-session/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.15">
    
    
      
        <title>Automating the Deployment of Infrastructure Using Deployment Manager - Tanvir's Notes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#automating-the-deployment-of-infrastructure-using-deployment-manager" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Tanvir&#39;s Notes" class="md-header__button md-logo" aria-label="Tanvir's Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tanvir's Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Automating the Deployment of Infrastructure Using Deployment Manager
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Tanvir&#39;s Notes" class="md-nav__button md-logo" aria-label="Tanvir's Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Tanvir's Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome to MkDocs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../01-linear-algebra-machine-learning/" class="md-nav__link">
        Linear Algebra for Machine Learning
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../02-git_workflow/" class="md-nav__link">
        Creating a repo
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../03-python-virtual-environments-with-jupyter/" class="md-nav__link">
        What are Python Virtual Environments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../04-ecommerce-payments/" class="md-nav__link">
        Structure
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../05-pubsub-google-clouds/" class="md-nav__link">
        05 pubsub google clouds
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../07-tmux/" class="md-nav__link">
        Tmux
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../08-using-system-clipboard-in-vim/" class="md-nav__link">
        08 using system clipboard in vim
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../09-padi-openwater-sec1/" class="md-nav__link">
        09 padi openwater sec1
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../10-padi-openwater-sec2/" class="md-nav__link">
        10 padi openwater sec2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../11-padi-openwater-sec3/" class="md-nav__link">
        11 padi openwater sec3
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../12-padi-openwater-sec3-problem-management/" class="md-nav__link">
        12 padi openwater sec3 problem management
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../13-padi-openwater-sec3-equipment3/" class="md-nav__link">
        13 padi openwater sec3 equipment3
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../14-padi-openwater-sec3-skills2/" class="md-nav__link">
        14 padi openwater sec3 skills2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../15-padi-openwater-sec4-equipment4/" class="md-nav__link">
        15 padi openwater sec4 equipment4
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../16-padi-openwater-sec4-diver4/" class="md-nav__link">
        16 padi openwater sec4 diver4
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../17-padi-openwater-sec4-divecomputers1/" class="md-nav__link">
        17 padi openwater sec4 divecomputers1
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../18-padi-openwater-sec4-skills4/" class="md-nav__link">
        18 padi openwater sec4 skills4
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../19-padi-openwater-sec5-divecomputers2/" class="md-nav__link">
        19 padi openwater sec5 divecomputers2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../20-padi-openwater-sec5-diver5/" class="md-nav__link">
        20 padi openwater sec5 diver5
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../21-padi-sec5-skills5/" class="md-nav__link">
        21 padi sec5 skills5
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../22-ubuntu-bluetooth-uninstall-reinstall/" class="md-nav__link">
        22 ubuntu bluetooth uninstall reinstall
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../23-advanced-big-query/" class="md-nav__link">
        Objectives
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../24-freedomticket-week1-intro-to-selling/" class="md-nav__link">
        24 freedomticket week1 intro to selling
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../25-gcp-essential-infrastructure-cloud-sql/" class="md-nav__link">
        Implementing Cloud SQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../26-gcp-essential-infrastructure-monitoring/" class="md-nav__link">
        Resource Monitoring
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../27-gcp-elastic-cloud-vpn/" class="md-nav__link">
        Virtual Private Networks (VPN)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../28-http-load-balancer/" class="md-nav__link">
        Configuring an HTTP Load Balancer with Autoscaling
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../29-internal-load-balancer/" class="md-nav__link">
        Configuring an Internal Load Balancer
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Automating the Deployment of Infrastructure Using Deployment Manager
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Automating the Deployment of Infrastructure Using Deployment Manager
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-1-configure-the-network" class="md-nav__link">
    Task 1. Configure the network
  </a>
  
    <nav class="md-nav" aria-label="Task 1. Configure the network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verify-that-the-deployment-manager-api-is-enabled" class="md-nav__link">
    Verify that the Deployment Manager API is enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-cloud-shell-editor" class="md-nav__link">
    Start the Cloud Shell Editor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-auto-mode-network-configuration" class="md-nav__link">
    Create the auto mode network configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-configure-the-firewall-rule" class="md-nav__link">
    Task 2. Configure the firewall rule
  </a>
  
    <nav class="md-nav" aria-label="Task 2. Configure the firewall rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-the-firewall-rule-to-the-configuration" class="md-nav__link">
    Add the firewall rule to the configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-3-create-a-template-for-vm-instances" class="md-nav__link">
    Task 3. Create a template for VM instances
  </a>
  
    <nav class="md-nav" aria-label="Task 3. Create a template for VM instances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-vm-instance-template" class="md-nav__link">
    Create the VM instance template
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-configuration" class="md-nav__link">
    Deploy the configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-5-verify-your-deployment" class="md-nav__link">
    Task 5. Verify your deployment
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../31-aws-session/" class="md-nav__link">
        31 aws session
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../32-gcp-cloud-build/" class="md-nav__link">
        32 gcp cloud build
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../33-gcp-deploying-kubernetes/" class="md-nav__link">
        33 gcp deploying kubernetes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../34-gcp-creating-kubernetes-engine-deployments/" class="md-nav__link">
        Creating Google Kubernetes Engine Deployments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../35-gcp-persistent-volume-for-gke/" class="md-nav__link">
        Configuring persistent volume for Google Kubernetes Engine
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../36-gcloud-basics/" class="md-nav__link">
        Basic gcloud commands
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../37-migrate-for-anthos/" class="md-nav__link">
        37 migrate for anthos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../38-kubectl-basics/" class="md-nav__link">
        38 kubectl basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../39-creating-gke-deployments/" class="md-nav__link">
        39 creating gke deployments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../40-data-reliability-conference/" class="md-nav__link">
        40 data reliability conference
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../41-persistent-storage-gke/" class="md-nav__link">
        Persistent storage in GKE
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../42-creating-gke-deployments-from-shell/" class="md-nav__link">
        42 creating gke deployments from shell
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../43-setting-up-react/" class="md-nav__link">
        Steps to run react in local environment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../44-redis-with-gcp-cloud-func/" class="md-nav__link">
        44 redis with gcp cloud func
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../45-john-doerr-okr-ted-talk/" class="md-nav__link">
        OKRs
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-1-configure-the-network" class="md-nav__link">
    Task 1. Configure the network
  </a>
  
    <nav class="md-nav" aria-label="Task 1. Configure the network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verify-that-the-deployment-manager-api-is-enabled" class="md-nav__link">
    Verify that the Deployment Manager API is enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-cloud-shell-editor" class="md-nav__link">
    Start the Cloud Shell Editor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-auto-mode-network-configuration" class="md-nav__link">
    Create the auto mode network configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-configure-the-firewall-rule" class="md-nav__link">
    Task 2. Configure the firewall rule
  </a>
  
    <nav class="md-nav" aria-label="Task 2. Configure the firewall rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-the-firewall-rule-to-the-configuration" class="md-nav__link">
    Add the firewall rule to the configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-3-create-a-template-for-vm-instances" class="md-nav__link">
    Task 3. Create a template for VM instances
  </a>
  
    <nav class="md-nav" aria-label="Task 3. Create a template for VM instances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-vm-instance-template" class="md-nav__link">
    Create the VM instance template
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-configuration" class="md-nav__link">
    Deploy the configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-5-verify-your-deployment" class="md-nav__link">
    Task 5. Verify your deployment
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="automating-the-deployment-of-infrastructure-using-deployment-manager">Automating the Deployment of Infrastructure Using Deployment Manager</h1>
<h2 id="overview">Overview</h2>
<p>Deployment Manager is an infrastructure deployment service that automates the creation and management of Google Cloud resources. Write flexible template and configuration files and use them to create deployments that have a variety of Cloud Platform services, such as Cloud Storage, Compute Engine, and Cloud SQL, configured to work together.</p>
<p>In this lab, you create a Deployment Manager configuration with a template to automate the deployment of Google Cloud infrastructure. Specifically, you deploy one auto mode network with a firewall rule and two VM instances</p>
<h2 id="objectives">Objectives</h2>
<p>Create a configuration for an auto mode network</p>
<p>Create a configuration for a firewall rule</p>
<p>Create a template for VM instances</p>
<p>Create and deploy a configuration</p>
<p>Verify the deployment of a configuration</p>
<h2 id="task-1-configure-the-network">Task 1. Configure the network</h2>
<p>A configuration describes all the resources you want for a single deployment.</p>
<h3 id="verify-that-the-deployment-manager-api-is-enabled">Verify that the Deployment Manager API is enabled</h3>
<p>In the Cloud Console, on the Navigation menu (Navigation menu), click APIs &amp; services &gt; Library.</p>
<p>In the search bar, type Deployment Manager, and click the result for Cloud Deployment Manager V2 API.</p>
<h3 id="start-the-cloud-shell-editor">Start the Cloud Shell Editor</h3>
<p>To write the configuration and the template, you use the Cloud Shell Editor.</p>
<p>In the Cloud Console, click Activate Cloud Shell (Cloud Shell).</p>
<p>If prompted, click Continue.</p>
<p>Run the following commands:</p>
<p>mkdir dminfra
cd dminfra</p>
<p>In Cloud Shell, click Open Editor (Cloud Shell Editor).</p>
<p>In the left pane of the code editor, expand the dminfra folder.</p>
<h3 id="create-the-auto-mode-network-configuration">Create the auto mode network configuration</h3>
<p>A configuration is a file written in YAML syntax that lists each of the resources you want to create and their respective resource properties. A configuration must contain a resources: section followed by the list of resources to create. Start the configuration with the mynetwork resource.</p>
<p>To create a new file, click File &gt; New File.</p>
<p>Name the new file config.yaml, and then open it.</p>
<p>Copy the following base code into config.yaml:</p>
<pre><code>resources:
# Create the auto-mode network
- name: [RESOURCE_NAME]
  type: [RESOURCE_TYPE]
  properties:
    #RESOURCE properties go here
</code></pre>
<p>In config.yaml, replace <code>[RESOURCE_NAME]</code> with mynetwork</p>
<p>To get a list of all available network resource types in Google Cloud, run the following command in Cloud Shell:</p>
<pre><code>gcloud deployment-manager types list | grep network
</code></pre>
<p>The output should look like this (do not copy; this is example output):</p>
<pre><code>compute.beta.subnetwork
compute.alpha.subnetwork
compute.v1.subnetwork
compute.beta.network
compute.v1.network
compute.alpha.network
</code></pre>
<p>Locate compute.v1.network, which is the type needed to create a VPC network using Deployment Manager.</p>
<p>By definition, an auto mode network automatically creates a subnetwork in each region. </p>
<h2 id="task-2-configure-the-firewall-rule">Task 2. Configure the firewall rule</h2>
<p>In order to allow ingress traffic instances in mynetwork, you need to create a firewall rule.</p>
<h3 id="add-the-firewall-rule-to-the-configuration">Add the firewall rule to the configuration</h3>
<p>Add a firewall rule that allows HTTP, SSH, RDP, and ICMP traffic on mynetwork.</p>
<p>To get a list of all available firewall rule resource types in Google Cloud, run the following command in Cloud Shell:</p>
<pre><code>gcloud deployment-manager types list | grep firewall
</code></pre>
<p>The output should look like this (do not copy; this is example output):</p>
<pre><code>compute.v1.firewall
compute.alpha.firewall
compute.beta.firewall
</code></pre>
<p>Locate compute.v1.firewall, which is the type needed to create a firewall rule using Deployment Manager.</p>
<p>The final <code>config.yaml</code></p>
<pre><code>imports:
- path: instance-template.jinja

resources:
# Create the auto-mode network
- name: mynetwork
  type: compute.v1.network
  properties:
    autoCreateSubnetworks: true
# Create the firewall rule
- name: mynetwork-allow-http-ssh-rdp-icmp
  type: compute.v1.firewall
  properties:
    network: $(ref.mynetwork.selfLink)
    sourceRanges: [&quot;0.0.0.0/0&quot;]
    allowed:
    - IPProtocol: TCP
      ports: [22, 80, 3389]
    - IPProtocol: ICMP

# Create the mynet-us-vm instance
- name: mynet-us-vm
  type: instance-template.jinja
  properties:
    zone: us-central1-a
    machineType: n1-standard-1
    network: $(ref.mynetwork.selfLink)
    subnetwork: regions/us-central1/subnetworks/mynetwork

# Create the mynet-eu-vm instance
- name: mynet-eu-vm
  type: instance-template.jinja
  properties:
    zone: europe-west1-d
    machineType: n1-standard-1
    network: $(ref.mynetwork.selfLink)  
    subnetwork: regions/europe-west1/subnetworks/mynetwork
</code></pre>
<h2 id="task-3-create-a-template-for-vm-instances">Task 3. Create a template for VM instances</h2>
<p>Deployment Manager allows you to use Python or Jinja2 templates to parameterize your configuration. This allows you to reuse common deployment paradigms such as networks, firewall rules, and VM instances.</p>
<h3 id="create-the-vm-instance-template">Create the VM instance template</h3>
<p>Because you will be creating two similar VM instances, create a VM instance template.</p>
<p>To create a new file, click File &gt; New File.</p>
<p>Name the new file instance-template.jinja, and then open it.</p>
<p>Properties to define:</p>
<p>machineType: Machine type and zone
zone: Instance zone
networkInterfaces: Network and subnetwork that VM is attached to
accessConfigs: Required to give the instance a public IP address (required in this lab). To create instances with only an internal IP address, remove the accessConfigs section.
disks: The boot disk, its name and image
Most properties are defined as template properties, which you will provide values for from the top-level configuration (config.yaml).</p>
<p>To get a list of all available instance resource types in Google Cloud, run the following command in Cloud Shell:</p>
<pre><code>gcloud deployment-manager types list | grep instance
</code></pre>
<p>Locate compute.v1.instance, which is the type needed to create a VM instance using Deployment Manager.</p>
<p>Final <code>instance-template.jinja</code>:</p>
<pre><code> resources:
- name: {{ env[&quot;name&quot;] }}
  type: compute.v1.instance  
  properties:
     machineType: zones/{{ properties[&quot;zone&quot;] }}/machineTypes/{{ properties[&quot;machineType&quot;] }}
     zone: {{ properties[&quot;zone&quot;] }}
     networkInterfaces:
      - network: {{ properties[&quot;network&quot;] }}
        subnetwork: {{ properties[&quot;subnetwork&quot;] }}
        accessConfigs:
        - name: External NAT
          type: ONE_TO_ONE_NAT
     disks:
      - deviceName: {{ env[&quot;name&quot;] }}
        type: PERSISTENT
        boot: true
        autoDelete: true
        initializeParams:
          sourceImage: https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/family/debian-9
</code></pre>
<h2 id="deploy-the-configuration">Deploy the configuration</h2>
<pre><code>gcloud deployment-manager deployments create dminfra --config=config.yaml --preview
</code></pre>
<pre><code>gcloud deployment-manager deployments update dminfra
</code></pre>
<p>Or, directly deploy:</p>
<pre><code>gcloud deployment-manager deployments create dminfra --config=config.yaml
</code></pre>
<p>Delete using:</p>
<pre><code>gcloud deployment-manager deployments delete dminfra
</code></pre>
<h2 id="task-5-verify-your-deployment">Task 5. Verify your deployment</h2>
<p>Verify your network in the Cloud Console</p>
<p>In the Cloud Console, on the Navigation menu (Navigation menu), click VPC network &gt; VPC networks.</p>
<p>View the mynetwork VPC network with a subnetwork in every region.</p>
<p>On the Navigation menu, click VPC network &gt; Firewall.</p>
<p>Sort the firewall rules by Network.</p>
<p>View the mynetwork-allow-http-ssh-rdp-icmp firewall rule for mynetwork.</p>
<p>Verify your VM instances in the Cloud Console</p>
<p>On the Navigation menu (Navigation menu), click Compute Engine &gt; VM instances.</p>
<p>View the mynet-us-vm and mynet-eu-vm instances.</p>
<p>Note the internal IP address for mynet-eu-vm.</p>
<p>For mynet-us-vm, click SSH to launch a terminal and connect.</p>
<p>To test connectivity to mynet-eu-vm's internal IP address, run the following command in the SSH terminal (replacing mynet-eu-vm's internal IP address with the value noted earlier):</p>
<pre><code>ping -c 3 &lt;Enter mynet-eu-vm's internal IP here&gt;
</code></pre>
<p>This should work because both VM instances are on the same network and the firewall rule allows ICMP traffic!</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
    
  </body>
</html>