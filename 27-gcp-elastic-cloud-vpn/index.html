<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://tanviralam.com/27-gcp-elastic-cloud-vpn/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Virtual Private Networks (VPN) - Tanvir's Notes</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Virtual Private Networks (VPN)";
        var mkdocs_page_input_path = "27-gcp-elastic-cloud-vpn.md";
        var mkdocs_page_url = "/27-gcp-elastic-cloud-vpn/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Tanvir's Notes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Welcome to MkDocs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../01-linear-algebra-machine-learning/">Linear Algebra for Machine Learning</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../02-git_workflow/">Creating a repo</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../03-python-virtual-environments-with-jupyter/">What are Python Virtual Environments</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../04-ecommerce-payments/">Structure</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../05-pubsub-google-clouds/">05 pubsub google clouds</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../07-tmux/">Tmux</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../08-using-system-clipboard-in-vim/">08 using system clipboard in vim</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../09-padi-openwater-sec1/">09 padi openwater sec1</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../10-padi-openwater-sec2/">10 padi openwater sec2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../11-padi-openwater-sec3/">11 padi openwater sec3</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../12-padi-openwater-sec3-problem-management/">12 padi openwater sec3 problem management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../13-padi-openwater-sec3-equipment3/">13 padi openwater sec3 equipment3</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../14-padi-openwater-sec3-skills2/">14 padi openwater sec3 skills2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../15-padi-openwater-sec4-equipment4/">15 padi openwater sec4 equipment4</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../16-padi-openwater-sec4-diver4/">16 padi openwater sec4 diver4</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../17-padi-openwater-sec4-divecomputers1/">17 padi openwater sec4 divecomputers1</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../18-padi-openwater-sec4-skills4/">18 padi openwater sec4 skills4</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../19-padi-openwater-sec5-divecomputers2/">19 padi openwater sec5 divecomputers2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../20-padi-openwater-sec5-diver5/">20 padi openwater sec5 diver5</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../21-padi-sec5-skills5/">21 padi sec5 skills5</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../22-ubuntu-bluetooth-uninstall-reinstall/">22 ubuntu bluetooth uninstall reinstall</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../23-advanced-big-query/">Objectives</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../24-freedomticket-week1-intro-to-selling/">24 freedomticket week1 intro to selling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../25-gcp-essential-infrastructure-cloud-sql/">Implementing Cloud SQL</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../26-gcp-essential-infrastructure-monitoring/">Resource Monitoring</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Virtual Private Networks (VPN)</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#objectives">Objectives</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#task-1-explore-the-networks-and-instances">Task 1: Explore the networks and instances</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#task-2-create-the-vpn-gateways-and-tunnels">Task 2: Create the VPN gateways and tunnels</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#reserve-two-static-ip-addresses">Reserve two static IP addresses</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#create-the-vpn-1-gateway-and-tunnel1to2">Create the vpn-1 gateway and tunnel1to2</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#create-the-vpn-2-gateway-and-tunnel2to1">Create the vpn-2 gateway and tunnel2to1</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#task-3-verify-vpn-connectivity">Task 3: Verify VPN connectivity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#verify-server-1-to-server-2-connectivity">Verify server-1 to server-2 connectivity</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#remove-the-external-ip-addresses">Remove the external IP addresses</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../28-http-load-balancer/">Configuring an HTTP Load Balancer with Autoscaling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../29-internal-load-balancer/">Configuring an Internal Load Balancer</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../30-deployment-manager/">Automating the Deployment of Infrastructure Using Deployment Manager</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../31-aws-session/">31 aws session</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../32-gcp-cloud-build/">32 gcp cloud build</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../33-gcp-deploying-kubernetes/">33 gcp deploying kubernetes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../34-gcp-creating-kubernetes-engine-deployments/">Creating Google Kubernetes Engine Deployments</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../35-gcp-persistent-volume-for-gke/">Configuring persistent volume for Google Kubernetes Engine</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../36-gcloud-basics/">Basic gcloud commands</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../37-migrate-for-anthos/">37 migrate for anthos</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../38-kubectl-basics/">38 kubectl basics</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../39-creating-gke-deployments/">39 creating gke deployments</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../40-data-reliability-conference/">40 data reliability conference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../41-persistent-storage-gke/">Persistent storage in GKE</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../42-creating-gke-deployments-from-shell/">42 creating gke deployments from shell</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../43-setting-up-react/">Steps to run react in local environment</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../44-redis-with-gcp-cloud-func/">44 redis with gcp cloud func</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Tanvir's Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Virtual Private Networks (VPN)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="virtual-private-networks-vpn">Virtual Private Networks (VPN)</h1>
<h2 id="objectives">Objectives</h2>
<p>Create VPN gateways in each network</p>
<p>Create VPN tunnels between the gateways</p>
<p>Verify VPN connectivity</p>
<h2 id="task-1-explore-the-networks-and-instances">Task 1: Explore the networks and instances</h2>
<p>Ping VM instances external IP using </p>
<pre><code>ping -c 3 &lt;external IP address&gt;
</code></pre>
<h2 id="task-2-create-the-vpn-gateways-and-tunnels">Task 2: Create the VPN gateways and tunnels</h2>
<p>Establish private communication between the two VM instances by creating VPN gateways and tunnels between the two networks.</p>
<h3 id="reserve-two-static-ip-addresses">Reserve two static IP addresses</h3>
<p>Reserve one static IP address for each VPN gateway.</p>
<p>In the Cloud Console, on the Navigation menu (Navigation menu), click VPC network &gt; External IP addresses.</p>
<p>Click Reserve static address.</p>
<p>Specify the following, and leave the remaining settings as their defaults:
Property    Value (type value or select option as specified)
Name    vpn-1-static-ip
IP version  IPv4
Region  us-central1</p>
<p>Click Reserve.</p>
<p>Repeat the same for vpn-2-static-ip.</p>
<p>Click Reserve static address.</p>
<p>Specify the following, and leave the remaining settings as their defaults:
Property    Value (type value or select option as specified)
Name    vpn-2-static-ip
IP version  IPv4
Region  europe-west1</p>
<h3 id="create-the-vpn-1-gateway-and-tunnel1to2">Create the vpn-1 gateway and tunnel1to2</h3>
<p>In the Cloud Console, on the Navigation menu (Navigation menu), click Hybrid Connectivity &gt; VPN.</p>
<p>Click Create VPN Connection.</p>
<p>If asked, select Classic VPN, and then click Continue.</p>
<p>Specify the following in the VPN gateway section, and leave the remaining settings as their defaults:</p>
<p>Property    Value (type value or select option as specified)
Name    vpn-1
Network vpn-network-1
Region  us-central1
IP address  vpn-1-static-ip</p>
<p>Specify the following in the Tunnels section, and leave the remaining settings as their defaults:</p>
<p>Property    Value (type value or select option as specified)
Name    tunnel1to2
Remote peer IP address  [VPN-2-STATIC-IP]
IKE pre-shared key  gcprocks
Routing options Route-based
Remote network IP ranges    10.1.3.0/24 [internal ip address for vm instance 2]</p>
<p>Equivalent command line: </p>
<pre><code>gcloud compute target-vpn-gateways create vpn-1 --project=qwiklabs-gcp-03-bc85da7e9da5 --region=us-central1 --network=vpn-network-1 

gcloud compute forwarding-rules create vpn-1-rule-esp --project=qwiklabs-gcp-03-bc85da7e9da5 --region=us-central1 --address=34.71.63.22 --ip-protocol=ESP --target-vpn-gateway=vpn-1 

gcloud compute forwarding-rules create vpn-1-rule-udp500 --project=qwiklabs-gcp-03-bc85da7e9da5 --region=us-central1 --address=34.71.63.22 --ip-protocol=UDP --ports=500 --target-vpn-gateway=vpn-1 

gcloud compute forwarding-rules create vpn-1-rule-udp4500 --project=qwiklabs-gcp-03-bc85da7e9da5 --region=us-central1 --address=34.71.63.22 --ip-protocol=UDP --ports=4500 --target-vpn-gateway=vpn-1 

gcloud compute vpn-tunnels create tunnel1to2 --project=qwiklabs-gcp-03-bc85da7e9da5 --region=us-central1 --peer-address=34.79.170.227 --shared-secret=gcprocks --ike-version=2 --local-traffic-selector=0.0.0.0/0 --remote-traffic-selector=0.0.0.0/0 --target-vpn-gateway=vpn-1 

gcloud compute routes create tunnel1to2-route-1 --project=qwiklabs-gcp-03-bc85da7e9da5 --network=vpn-network-1 --priority=1000 --destination-range=10.1.3.0/24 --next-hop-vpn-tunnel=tunnel1to2 --next-hop-vpn-tunnel-region=us-central1
</code></pre>
<p>Click Create.</p>
<h3 id="create-the-vpn-2-gateway-and-tunnel2to1">Create the vpn-2 gateway and tunnel2to1</h3>
<p>Click VPN setup wizard.</p>
<p>If asked, select Classic VPN, and then click Continue.</p>
<p>Specify the following in the VPN gateway section, and leave the remaining settings as their defaults:
Property    Value (type value or select option as specified)
Name    vpn-2
Network vpn-network-2
Region  europe-west1
IP address  vpn-2-static-ip</p>
<p>Specify the following in the Tunnels section, and leave the remaining settings as their defaults:
Property    Value (type value or select option as specified)
Name    tunnel2to1
Remote peer IP address  [VPN-1-STATIC-IP]
IKE pre-shared key  gcprocks
Routing options Route-based
Remote network IP ranges    10.5.4.0/24 [internal ip address for vm instance 1]</p>
<h2 id="task-3-verify-vpn-connectivity">Task 3: Verify VPN connectivity</h2>
<p>Now we should be able to ping both internal and external IP addresses.</p>
<h3 id="verify-server-1-to-server-2-connectivity">Verify server-1 to server-2 connectivity</h3>
<p>In the Cloud Console, on the Navigation menu, click Compute Engine &gt; VM instances.</p>
<p>For server-1, click SSH to launch a terminal and connect.</p>
<p>To test connectivity to server-2's internal IP address, run the following command:</p>
<pre><code>ping -c 3 &lt;insert server-2's internal IP address here&gt;
</code></pre>
<h3 id="remove-the-external-ip-addresses">Remove the external IP addresses</h3>
<p>Now that you verified VPN connectivity, you can remove the instances' external IP addresses. For demonstration purposes, just do this for the server-1 instance.</p>
<p>On the Navigation menu, click Compute Engine &gt; VM instances.
Select the server-1 instance and click Stop. Wait for the instance to stop.</p>
<pre><code>Instances need to be stopped before you can make changes to their network interfaces.
</code></pre>
<p>Click on the name of the server-1 instance to open the VM instance details page.
Click Edit.
For Network interfaces, click the Edit icon (Edit).
Change External IP to None.
Click Done.
Click Save and wait for the instance details to update.
Click Start.
Click Start again to confirm that you want to start the VM instance.
Return to the VM instances page and wait for the instance to start.
Notice that External IP is set to None for the server-1 instance.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../26-gcp-essential-infrastructure-monitoring/" class="btn btn-neutral float-left" title="Resource Monitoring"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../28-http-load-balancer/" class="btn btn-neutral float-right" title="Configuring an HTTP Load Balancer with Autoscaling">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../26-gcp-essential-infrastructure-monitoring/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../28-http-load-balancer/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
